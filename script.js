// Language content objects
const content = {
    ru: {
        themeToggle: {
            light: 'Чернила',
            dark: 'Бумага'
        },
        languageToggle: 'Eng',
        meta: {
            title: 'Работа Данияра Агабекова',
            description: 'Ищете копирайтера? Это я.'
        },
        name: 'Данияр Агабеков',
        title: 'Хороший текст начинается с разговора. Напишите: agabekovd@gmail.com',
        sections: {
            about: {
                title: 'Обо мне',
                content: [
                    'Я пишу тексты. Пишу уже 11&nbsp;лет. И делаю это довольно хорошо.',
                    'Вот что у меня получается лучше всего.',
                    'Писать с&nbsp;заботой&nbsp;— чтобы люди чувствовали любовь и&nbsp;уважение к&nbsp;себе, чтобы они не&nbsp;думали, что они глупые, когда пользуются вашими продуктами, чтобы чувствовали, что о&nbsp;них переживают, и&nbsp;что им&nbsp;хотят помочь.',
                    'Могу помочь, когда наступают сложные моменты&nbsp;— когда нужно сообщить клиентам непростую новость или объяснить изменения, которые могут вызвать беспокойство. <span class="highlight">Я&nbsp;тщательно подбираю каждое слово, чтобы сохранить доверие, которое вы&nbsp;строили годами.</span> Я&nbsp;помогаю вашим клиентам понять, что даже в&nbsp;непростых ситуациях вы&nbsp;остаётесь на&nbsp;их&nbsp;стороне, цените их&nbsp;и&nbsp;стремитесь сделать всё возможное, чтобы ваши отношения продолжались и&nbsp;крепли, несмотря на&nbsp;временные трудности.',
                    'И&nbsp;формулировать смыслы&nbsp;— превращать сложные идеи в&nbsp;ясные сообщения, которые находят отклик. Я&nbsp;помогаю компаниям выражать их&nbsp;ценности так, чтобы каждый понял суть без лишних слов. Создаю тексты, где за&nbsp;каждым предложением стоит цель и&nbsp;намерение, где нет места пустым фразам. <span class="highlight">Когда люди читают мои тексты, они видят картину целиком, понимают «почему» за&nbsp;каждым «что» и&nbsp;чувствуют связь с&nbsp;брендом на&nbsp;более глубоком уровне.</span>',
                ]
            },
            services: {
                title: 'Чем занимаюсь',
                content: [
                    {
                        title: 'Маркетинговый копирайтинг',
                        text: 'Объясняю, чем вы&nbsp;полезны клиентам и&nbsp;почему вас стоит выбрать. Не&nbsp;давлю на&nbsp;людей и&nbsp;не&nbsp;использую маркетинговые штампы&nbsp;— просто даю информацию, которая помогает принять решение в&nbsp;вашу пользу.'
                    },
                    {
                        title: 'UX-копирайтинг',
                        text: 'Пишу для приложений и&nbsp;сайтов так, чтобы не&nbsp;запутать, а&nbsp;помочь. Сделать взаимодействие с&nbsp;вашим продуктом приятным и&nbsp;понятным. Когда пользователь увидит текст, он&nbsp;сразу понимает, что происходит и&nbsp;что делать дальше.'
                    },
                    {
                        title: 'Гострайтинг',
                        text: 'Изучаю особенности вашей речи, а&nbsp;затем создаю тексты, которые звучат так, будто вы&nbsp;написали их&nbsp;сами. Это всё останется анонимным, никто не&nbsp;узнает о&nbsp;моей работе.',
                        additionalText: 'Руковожу своей студией гострайтинга. Работаем с корпорациями, стартапами и экспертами. <a href="https://noname.daniyar.link" target="_blank">Подробнее</a>'
                    }
                ]
            },
            clients: {
                title: 'Клиенты',
                intro: 'С&nbsp;одними работали долго и&nbsp;сделали много, а&nbsp;с&nbsp;кем-то&nbsp;— совсем чуть-чуть. Но&nbsp;я&nbsp;всех помню и&nbsp;люблю.'
            },
            workExperience: {
                title: 'Опыт',
                inStaff: 'В штате',
                freelance: 'Проектно',
                positions: {
                    'Продуктовый редактор': 'UX-writer',
                    'Редактор коммуникаций и менеджер спецпроектов': 'Head of Content',
                    'Редактор коммуникаций и продуктов': 'Communications and Product Editor',
                    'Старший копирайтер': 'Senior Copywriter',
                    'Автор рассылки': 'Newsletter Writer',
                    'CRM-копирайтер': 'CRM-copywriter',
                    'Копирайтер': 'Copywriter'
                }
            },
            education: {
                title: 'Образование'
            },
            contact: {
                title: 'Давайте поговорим'
            }
        },
        footer: {
            copyright: '© 2025 Данияр Агабеков'
        }
    },
    en: {
        themeToggle: {
            light: 'Ink',
            dark: 'Paper'
        },
        languageToggle: 'Рус',
        meta: {
            title: 'Daniyar Agabekov\'s Work',
            description: 'Looking for a copywriter? That\'s me.'
        },
        name: 'Daniyar Agabekov',
        title: 'Great copy starts with a conversation. Email me: agabekovd@gmail.com',
        sections: {
            about: {
                title: 'About me',
                content: [
                    'I write copy. I\'ve been writing for 11 years. And I\'m pretty good at it.',
                    'Here\'s what I do best.',
                    'I write with care — so people feel loved and respected, so they never feel stupid when using your products, so they know you genuinely care about them and want to help.',
                    'I can help when things get tough — when you need to deliver difficult news to customers or explain changes that might cause concern. <span class="highlight">I carefully choose every word to preserve the trust you\'ve spent years building.</span> I help your customers understand that even in challenging situations, you\'re still on their side, you value them, and you\'re committed to doing everything possible to keep your relationship strong, despite temporary difficulties.',
                    'And I shape ideas — turning complex concepts into clear messages that resonate. I help companies express their values so everyone gets the essence without unnecessary words. I create copy where every sentence has purpose and intention, where there\'s no room for empty phrases. <span class="highlight">When people read my work, they see the full picture, understand the "why" behind every "what," and feel connected to the brand on a deeper level.</span>',
                ]
            },
            services: {
                title: 'What I do',
                content: [
                    {
                        title: 'Marketing copywriting',
                        text: 'I explain how you help customers and why they should choose you. No pressure tactics or marketing clichés — just clear information that helps people decide in your favor.'
                    },
                    {
                        title: 'UX copywriting',
                        text: 'I write for apps and websites to guide, not confuse. Making interactions with your product smooth and intuitive. When users see the text, they immediately understand what\'s happening and what to do next.'
                    },
                    {
                        title: 'Ghostwriting',
                        text: 'I study your unique voice, then create content that sounds exactly like you wrote it yourself. Everything stays completely anonymous — no one will ever know about my involvement.',
                        additionalText: 'I run my own ghostwriting studio. We work with corporations, startups, and industry experts. <a href="https://noname.daniyar.link" target="_blank">Learn more</a>'
                    }
                ]
            },
            clients: {
                title: 'Clients',
                intro: 'Some we\'ve worked with extensively and accomplished a lot together, while others — just briefly. But I remember and value them all.'
            },
            workExperience: {
                title: 'Experience',
                inStaff: 'Full-time',
                freelance: 'Project-based',
                positions: {
                    'Продуктовый редактор': 'UX-writer',
                    'Редактор коммуникаций и менеджер спецпроектов': 'Head of Content',
                    'Редактор коммуникаций и продуктов': 'Copywriter and UX-writer',
                    'Старший копирайтер': 'Senior Copywriter',
                    'Автор рассылки': 'Newsletter Writer',
                    'CRM-копирайтер': 'CRM-copywriter',
                    'Копирайтер': 'Copywriter'
                }
            },
            education: {
                title: 'Education',
                items: {
                    '2025. Курс: Продакт-менеджер | Product Masters': '2025. Course: Product Manager | Product Masters',
                    '2024. Курс: Introduction to UX-writing | Udemy': '2024. Course: Introduction to UX-writing | Udemy',
                    '2022. Курс UX-копирайтинг | Яндекс.Практикум': '2022. Course: UX Copywriting | Yandex.Practicum',
                    '2020. Воркшоп «Как разучиться придумывать рекламу» | mads': '2020. Workshop "How to Unlearn Creating Ads" | mads',
                    '2020. Курс: Digital-маркетолог | GeniusMarketing': '2020. Course: Digital Marketer | GeniusMarketing',
                    '2019. Курс: SEO-специалист | Нетология': '2019. Course: SEO Specialist | Netology',
                    '2018. Воркшоп: Контент-маркетинг | Максим Ильяхов': '2018. Workshop: Content Marketing | Maxim Ilyakhov',
                    '2017. Школа редакторов | Дизайн-бюро Артёма Горбунова': '2017. Editors School | Artem Gorbunov Design Bureau',
                    '2017. Курс: Основы HTML и CSS | Нетология': '2017. Course: HTML & CSS Fundamentals | Netology',
                    '2017. Курс: Веб-дизайн | Open IT': '2017. Course: Web Design | Open IT',
                    '2017. Курс: Работа с клиентом | Максим Ильяхов': '2017. Course: Client Relations | Maxim Ilyakhov',
                    '2016. Курс: Главред | Максим Ильяхов': '2016. Course: Chief Editor | Maxim Ilyakhov'
                }
            },
            contact: {
                title: 'Let\'s talk'
            }
        },
        footer: {
            copyright: '© 2025 Daniyar Agabekov'
        }
    }
};

// Function to detect user's preferred language based on location and browser settings
async function detectUserLanguage() {
    try {
        // Try IP-based geolocation first
        const response = await fetch('https://ipapi.co/json/');
        const data = await response.json();
        
        // Countries that typically use Russian
        const russianSpeakingCountries = [
            'RU', // Russia
            'KZ', // Kazakhstan 
            'BY', // Belarus
            'KG', // Kyrgyzstan
            'TJ', // Tajikistan
            'UZ', // Uzbekistan
            'AM', // Armenia
            'AZ', // Azerbaijan
            'GE', // Georgia
            'MD', // Moldova
            'UA'  // Ukraine
        ];
        
        if (data.country_code && russianSpeakingCountries.includes(data.country_code)) {
            return 'ru';
        } else if (data.country_code) {
            return 'en';
        }
    } catch (error) {
        console.log('IP geolocation failed, falling back to browser language');
    }
    
    // Fallback to browser language preference
    const browserLang = navigator.language || navigator.languages[0];
    if (browserLang.startsWith('ru')) {
        return 'ru';
    }
    
    // Default to English for all other cases
    return 'en';
}

document.addEventListener('DOMContentLoaded', async function() {
    // Language toggle functionality
    const languageToggle = document.querySelector('.language-toggle');
    let currentLanguage = localStorage.getItem('language');
    
    // Auto-detect language if not previously set
    if (!currentLanguage) {
        currentLanguage = await detectUserLanguage();
        localStorage.setItem('language', currentLanguage);
    }
    
    // Apply language on page load
    applyLanguage(currentLanguage);
    
    // Language toggle event listener
    languageToggle.addEventListener('click', function() {
        currentLanguage = currentLanguage === 'ru' ? 'en' : 'ru';
        localStorage.setItem('language', currentLanguage);
        applyLanguage(currentLanguage);
        
        // Make all content visible after language change
        showAllContent();
    });
    
    // Function to apply language
    function applyLanguage(lang) {
        const langContent = content[lang];
        
        // Update meta tags
        document.title = langContent.meta.title;
        document.querySelector('meta[name="description"]').setAttribute('content', langContent.meta.description);
        document.querySelector('meta[property="og:title"]').setAttribute('content', langContent.meta.title);
        document.querySelector('meta[property="og:description"]').setAttribute('content', langContent.meta.description);
        document.querySelector('meta[property="twitter:title"]').setAttribute('content', langContent.meta.title);
        document.querySelector('meta[property="twitter:description"]').setAttribute('content', langContent.meta.description);
        
        // Update language toggle button
        languageToggle.textContent = langContent.languageToggle;
        
        // Update theme toggle button text
        const isDark = document.body.classList.contains('dark-theme');
        const themeToggle = document.querySelector('.theme-toggle');
        themeToggle.textContent = isDark ? langContent.themeToggle.dark : langContent.themeToggle.light;
        
        // Update header content
        document.getElementById('name').textContent = langContent.name;
        document.getElementById('title').textContent = langContent.title;
        
        // Update section titles
        document.querySelector('#about h2').textContent = langContent.sections.about.title;
        document.querySelector('#services h2').textContent = langContent.sections.services.title;
        document.querySelector('#clients h2').textContent = langContent.sections.clients.title;
        document.querySelector('#work-experience h2').textContent = langContent.sections.workExperience.title;
        document.querySelector('#education h2').textContent = langContent.sections.education.title;
        document.querySelector('#contact h2').textContent = langContent.sections.contact.title;
        
        // Update footer copyright
        document.getElementById('footer-copyright').textContent = langContent.footer.copyright;
        
        // Update about section content
        const aboutContent = document.querySelector('#about .content');
        aboutContent.innerHTML = langContent.sections.about.content.map(p => `<p>${p}</p>`).join('');
        
        // Update services section content
        const servicesContent = document.querySelector('#services .content');
        let servicesHtml = '';
        langContent.sections.services.content.forEach(service => {
            servicesHtml += `<div class="service"><h3>${service.title}</h3><p>${service.text}</p>`;
            if (service.additionalText) {
                servicesHtml += `<p>${service.additionalText}</p>`;
            }
            servicesHtml += '</div>';
        });
        servicesContent.innerHTML = servicesHtml;
        
        // Update clients section intro
        const clientsContent = document.querySelector('#clients .content');
        const clientsIntro = clientsContent.querySelector('p');
        if (clientsIntro) {
            clientsIntro.innerHTML = langContent.sections.clients.intro;
        }
        
        // Update client items with translations
        const clientItems = document.querySelectorAll('.client-item');
        clientItems.forEach(item => {
            if (item.dataset.ru && item.dataset.en) {
                item.textContent = lang === 'ru' ? item.dataset.ru : item.dataset.en;
            }
        });
        
        // Update work experience section headers
        const workSectionTitles = document.querySelectorAll('.work-section-title');
        if (workSectionTitles[0]) workSectionTitles[0].textContent = langContent.sections.workExperience.inStaff;
        if (workSectionTitles[1]) workSectionTitles[1].textContent = langContent.sections.workExperience.freelance;
        
        // Update work experience positions
        const positions = document.querySelectorAll('.position');
        positions.forEach(position => {
            const originalText = position.textContent;
            if (lang === 'en' && langContent.sections.workExperience.positions[originalText]) {
                position.textContent = langContent.sections.workExperience.positions[originalText];
            } else if (lang === 'ru') {
                // Reset to Russian text if switching back to Russian
                const russianPositions = {
                    'UX-writer': 'Продуктовый редактор',
                    'Head of Content': 'Редактор коммуникаций и менеджер спецпроектов',
                    'Copywriter and UX-writer': 'Редактор коммуникаций и продуктов',
                    'Senior Copywriter': 'Старший копирайтер',
                    'Newsletter Writer': 'Автор рассылки',
                    'CRM-copywriter': 'CRM-копирайтер',
                    'Copywriter': 'Копирайтер'
                };
                if (russianPositions[originalText]) {
                    position.innerHTML = russianPositions[originalText];
                }
            }
        });

        // Update company names in work experience
        const companyNames = document.querySelectorAll('.company-name');
        companyNames.forEach(company => {
            const originalText = company.textContent;
            if (lang === 'en') {
                const companyTranslations = {
                    'Рекламное агентство «Комбинат»': '"Combinat" Advertising Agency'
                };
                if (companyTranslations[originalText]) {
                    company.textContent = companyTranslations[originalText];
                }
            } else if (lang === 'ru') {
                const companyTranslations = {
                    '"Combinat" Advertising Agency': 'Рекламное агентство «Комбинат»'
                };
                if (companyTranslations[originalText]) {
                    company.textContent = companyTranslations[originalText];
                }
            }
        });

        // Update work experience dates
        const workPeriods = document.querySelectorAll('.work-period');
        workPeriods.forEach(period => {
            let text = period.textContent;
            if (lang === 'en') {
                const months = {
                    'Январь': 'January', 'Февраль': 'February', 'Март': 'March', 'Апрель': 'April',
                    'Май': 'May', 'Июнь': 'June', 'Июль': 'July', 'Август': 'August',
                    'Сентябрь': 'September', 'Октябрь': 'October', 'Ноябрь': 'November', 'Декабрь': 'December',
                    'Сейчас': 'Present'
                };
                Object.keys(months).forEach(ru => {
                    text = text.replace(new RegExp(ru, 'g'), months[ru]);
                });
                period.textContent = text;
            } else if (lang === 'ru') {
                const months = {
                    'January': 'Январь', 'February': 'Февраль', 'March': 'Март', 'April': 'Апрель',
                    'May': 'Май', 'June': 'Июнь', 'July': 'Июль', 'August': 'Август',
                    'September': 'Сентябрь', 'October': 'Октябрь', 'November': 'Ноябрь', 'December': 'Декабрь',
                    'Present': 'Сейчас'
                };
                Object.keys(months).forEach(en => {
                    text = text.replace(new RegExp(en, 'g'), months[en]);
                });
                period.textContent = text;
            }
        });

        // Update education items
        const educationItems = document.querySelectorAll('.education-item');
        educationItems.forEach(item => {
            const originalText = item.textContent;
            if (lang === 'en' && langContent.sections.education.items && langContent.sections.education.items[originalText]) {
                item.textContent = langContent.sections.education.items[originalText];
            } else if (lang === 'ru') {
                // Reset to Russian text if switching back to Russian
                const russianEducationItems = {
                    '2025. Course: Product Manager | Product Masters': '2025. Курс: Продакт-менеджер | Product Masters',
                    '2024. Course: Introduction to UX-writing | Udemy': '2024. Курс: Introduction to UX-writing | Udemy',
                    '2022. Course: UX Copywriting | Yandex.Practicum': '2022. Курс UX-копирайтинг | Яндекс.Практикум',
                    '2020. Workshop "How to Unlearn Creating Ads" | mads': '2020. Воркшоп «Как разучиться придумывать рекламу» | mads',
                    '2020. Course: Digital Marketer | GeniusMarketing': '2020. Курс: Digital-маркетолог | GeniusMarketing',
                    '2019. Course: SEO Specialist | Netology': '2019. Курс: SEO-специалист | Нетология',
                    '2018. Workshop: Content Marketing | Maxim Ilyakhov': '2018. Воркшоп: Контент-маркетинг | Максим Ильяхов',
                    '2017. Editors School | Artem Gorbunov Design Bureau': '2017. Школа редакторов | Дизайн-бюро Артёма Горбунова',
                    '2017. Course: HTML & CSS Fundamentals | Netology': '2017. Курс: Основы HTML и CSS | Нетология',
                    '2017. Course: Web Design | Open IT': '2017. Курс: Веб-дизайн | Open IT',
                    '2017. Course: Client Relations | Maxim Ilyakhov': '2017. Курс: Работа с клиентом | Максим Ильяхов',
                    '2016. Course: Chief Editor | Maxim Ilyakhov': '2016. Курс: Главред | Максим Ильяхов'
                };
                if (russianEducationItems[originalText]) {
                    item.textContent = russianEducationItems[originalText];
                }
            }
        });
    }
    
    // Function to show all content immediately
    function showAllContent() {
        const sections = document.querySelectorAll('.typed-section');
        sections.forEach(section => {
            const content = section.querySelector('.content');
            if (content) {
                content.style.opacity = '1';
                content.classList.add('typed');
                
                // Make all text elements visible
                const textElements = content.querySelectorAll('p, h3, h4, li, blockquote p, cite, .client-item, .education-item, .work-period, .company-name, .social a');
                textElements.forEach(element => {
                    element.style.opacity = '1';
                    element.style.minHeight = '';
                    element.classList.remove('typing', 'no-cursor');
                    
                    // Update client items with translations
                    if (element.classList.contains('client-item') && element.dataset.ru && element.dataset.en) {
                        element.textContent = currentLanguage === 'ru' ? element.dataset.ru : element.dataset.en;
                    }
                });
            }
        });
    }
    
    // Theme toggle functionality
    const themeToggle = document.querySelector('.theme-toggle');
    const prefersDarkScheme = window.matchMedia('(prefers-color-scheme: dark)');
    
    // Check for saved theme preference or use system preference
    let currentTheme = localStorage.getItem('theme');
    const userHasManualPreference = currentTheme !== null;
    
    // If no manual preference, use system preference
    if (!userHasManualPreference) {
        currentTheme = prefersDarkScheme.matches ? 'dark' : 'light';
    }
    
    // Apply theme on page load
    if (currentTheme === 'dark') {
        document.body.classList.add('dark-theme');
        themeToggle.textContent = content[currentLanguage].themeToggle.dark;
    } else {
        document.body.classList.remove('dark-theme');
        themeToggle.textContent = content[currentLanguage].themeToggle.light;
    }
    
    // Toggle theme when button is clicked
    themeToggle.addEventListener('click', function() {
        document.body.classList.toggle('dark-theme');
        
        // Update button text based on current theme
        const isDark = document.body.classList.contains('dark-theme');
        themeToggle.textContent = isDark ? content[currentLanguage].themeToggle.dark : content[currentLanguage].themeToggle.light;
        
        // Save manual preference to localStorage
        localStorage.setItem('theme', isDark ? 'dark' : 'light');
    });
    
    // Listen for changes in system color scheme preference
    prefersDarkScheme.addEventListener('change', function(e) {
        // Only apply system preference if user hasn't set a manual preference
        if (!localStorage.getItem('theme')) {
            if (e.matches) {
                document.body.classList.add('dark-theme');
                themeToggle.textContent = content[currentLanguage].themeToggle.dark;
            } else {
                document.body.classList.remove('dark-theme');
                themeToggle.textContent = content[currentLanguage].themeToggle.light;
            }
        }
    });

    // Initial animation for header
    const name = document.getElementById('name');
    const title = document.getElementById('title');
    
    setTimeout(() => {
        name.style.opacity = '1';
        title.style.opacity = '1';
    }, 300);

    // Scroll-based section activation
    const sections = document.querySelectorAll('.typed-section');
    
    // Observer for section visibility
    const sectionObserver = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.classList.add('visible');
                
                // Show content immediately when section is visible
                const content = entry.target.querySelector('.content');
                if (content && !content.classList.contains('typed')) {
                    content.style.opacity = '1';
                    const textElements = content.querySelectorAll('p, h3, h4, li, blockquote p, cite, .client-item, .education-item, .work-period, .company-name, .social a');
                    textElements.forEach(element => {
                        element.style.opacity = '1';
                        
                        // Update client items with translations
                        if (element.classList.contains('client-item') && element.dataset.ru && element.dataset.en) {
                            element.textContent = currentLanguage === 'ru' ? element.dataset.ru : element.dataset.en;
                        }
                    });
                    content.classList.add('typed');
                }
            }
        });
    }, { threshold: 0.2 });
    
    // Observe all sections
    sections.forEach(section => {
        sectionObserver.observe(section);
    });
    
    // Smooth scrolling for navigation links
    const navLinks = document.querySelectorAll('nav a');
    
    navLinks.forEach(link => {
        link.addEventListener('click', function(e) {
            e.preventDefault();
            
            const targetId = this.getAttribute('href');
            const targetElement = document.querySelector(targetId);
            
            window.scrollTo({
                top: targetElement.offsetTop - 40,
                behavior: 'smooth'
            });
        });
    });
}); 